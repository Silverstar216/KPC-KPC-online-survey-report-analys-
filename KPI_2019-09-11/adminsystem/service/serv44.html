<?php
  if (!defined('_GNUBOARD_')) exit; // 개별 페이지 접근 불가   
$colspan = 5;

$g5['title'] = "내 메세지 그룹";

$res = sql_fetch("select count(*)+1 as cnt from {$g5['sms5_form_group_table']} where fg_member = '{$member['mb_no']}'");
$total_count = $res['cnt'];

$group = array();
$qry = sql_query("select fg_no,fg_name,ifnull((select count(*) from `{$g5['sms5_form_table']}` as b where b.fg_no=a.fg_no),0) as fg_count,fg_member from {$g5['sms5_form_group_table']} as a where fg_member = '{$member['mb_no']}' order by fg_name");
while ($res = sql_fetch_array($qry)) array_push($group, $res);
?>

<script>

function move(fg_no, fg_name, sel) {
    var msg = '';
    if (sel.value)
    {
        msg  = "'" + fg_name + "' 그룹에 속한 모든 데이터를\n\n'";
        msg += sel.options[sel.selectedIndex].text + "' 그룹으로 이동하시겠습니까?";

        if (confirm(msg)) {
<?php if ($is_guest) {?>
      alert("로그인 후 사용가능합니다.");
      document.location.replace("<?php echo G5_BBS_URL.'/login.php?url='.urlencode(G5_URL.'/serv.php?m1='.$pgMNo.'&m2='.$pgMNo1) ?>");
      return false;
<?php } else {?>                         
            location.href = '/service/form_group_move.php?fg_no=' + fg_no + '&move_no=' + sel.value;
<?php } ?>            
        }
        else
            sel.selectedIndex = 0;
    }
}

function empty(fg_no) {
    if (confirm("한번 삭제한 자료는 복구할 방법이 없습니다.\n\n그룹에 속한 데이터를 정말로 비우시겠습니까?")) {
<?php if ($is_guest) {?>
      alert("로그인 후 사용가능합니다.");
      document.location.replace("<?php echo G5_BBS_URL.'/login.php?url='.urlencode(G5_URL.'/serv.php?m1='.$pgMNo.'&m2='.$pgMNo1) ?>");
      return false;
<?php } else {?>                     
        location.href = '/service/form_group_update.php?w='+ fg_no +'&fg_no=' + fg_no;
<?php } ?>        
    }
}

function grouplist_submit(f)
{
    if (!is_checked("chk[]")) {
        alert(document.pressed+" 하실 항목을 하나 이상 선택하세요.");
        return false;
    }

    if(document.pressed == "선택삭제") {
        if(confirm("한번 삭제한 자료는 복구할 방법이 없습니다.\n\n삭제되는 그룹에 속한 자료는 '미분류'로 이동됩니다.\n\n그래도 삭제하시겠습니까?")) {
            f.w.value = "de";
        } else {
            return false;
        }
    }

    if(document.pressed == "선택비우기") {
        if(confirm("한번 삭제한 자료는 복구할 방법이 없습니다.\n\n그룹에 속한 데이터를 정말로 비우시겠습니까?")) {
            f.w.value = "em";
        } else {
            return false;
        }
    }
<?php if ($is_guest) {?>
      alert("로그인 후 사용가능합니다.");
      document.location.replace("<?php echo G5_BBS_URL.'/login.php?url='.urlencode(G5_URL.'/serv.php?m1='.$pgMNo.'&m2='.$pgMNo1) ?>");
      return false;
<?php } else {?>             
    return true;
<?php } ?>    
}

</script>
<div id="sub_content_sms">
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
            <td><img src="/service/images/title04_01.png" ></td>
            <td align="right"><img src="/service/images/home.png" width="2" height="2"> <strong>홈</strong> &lt; SMS &lt; 내 메세지 그룹</td>
    </tr>
    </table>  
<form name="group<?php echo $res['fg_no']?>" method="post" action="/service/form_group_update.php" class="local_sch02 local_sch">
<input type="hidden" name="fg_no" value="<?php echo $res['fg_no']?>">
<div>
    <label for="fg_name">그룹명<strong class="sound_only"> 필수</strong></label>
    <input type="text" id="fg_name" name="fg_name" required class="required frm_input">
    <input type="submit" value="추가" class="btn_submit">
</div>
<div class="sch_last">
    <span class="count_add01">그룹 갯수 : <?php echo $total_count ?></span>
</div>
</form>

<div class="local_desc01 local_desc">
    <p>그룹명순으로 정렬됩니다.</p>
</div>

<form name="group<?php echo $group[$i]['fg_no']?>" method="post" action="/service/form_group_update.php" onsubmit="return grouplist_submit(this);">
<input type="hidden" name="w" value="u">

<div class="tbl_head01 tbl_wrap">
    <table>
    <caption><?php echo $g5['title']; ?> 목록</caption>
    <thead>
    <tr>
        <th scope="col">
            <label for="chkall" class="sound_only">그룹 전체</label>
            <input type="checkbox" name="chkall" value="1" id="chkall" onclick="check_all(this.form)">
        </th>
        <th scope="col">그룹명</th>
        <th scope="col">메세지 수</th>
        <th scope="col">이동</th>
        <th scope="col">보기</th>
    </tr>
    </thead>
    <tbody>
    <?php
    $qry = sql_query("select count(*) as cnt from {$g5['sms5_form_table']} where fg_no=0");
    $res = sql_fetch_array($qry);
    ?>
    <tr>
        <td></td>
        <td>미분류</td>
        <td class="td_numbig"><?php echo number_format($res['cnt'])?></td>
        <td class="td_mng">
            <label for="select_fg_no_999" class="sound_only">그룹명</label>
            <select name="select_fg_no_999" id="select_fg_no_999" onchange="move(0, '미분류', this);">
                <option value=""></option>
                <?php for ($i=0; $i<count($group); $i++) { ?>
                <option value="<?php echo $group[$i]['fg_no']?>"> <?php echo $group[$i]['fg_name']?> </option>
                <?php } ?>
            </select>
        </td>
        <td class="td_mng">
            <a href="/serv.php?m1=4&m2=5&fg_no=0">보기</a>
            <!-- <button type="button" onclick="empty('no');">비우기</button> -->
        </td>
    </tr>
    <?php
    for ($i=0; $i<count($group); $i++) {
        $bg = 'bg'.(($i + 1)%2);
    ?>
    <tr class="<?php echo $bg; ?>">
        <td class="td_mng">
            <input type="hidden" name="fg_no[<?php echo $i ?>]" value="<?php echo $group[$i]['fg_no']?>" id="fg_no_<?php echo $i ?>">
            <label for="chk_<?php echo $i ?>" class="sound_only"><?php echo $group[$i]['fg_name']?></label>
            <input type="checkbox" name="chk[]" value="<?php echo $i ?>" id="chk_<?php echo $i ?>">
        </td>
        <td>
            <label for="fg_name_<?php echo $i; ?>" class="sound_only">그룹명</label>
            <input type="text" name="fg_name[<?php echo $i; ?>]" value="<?php echo $group[$i]['fg_name']?>" id="fg_name_<?php echo $i; ?>" class="frm_input">
        </td>
        <td class="td_numbig">
            <?php echo number_format($group[$i]['fg_count'])?>
        </td>
        <td class="td_mng">
            <label for="select_fg_no_<?php echo $i; ?>" class="sound_only">그룹명</label>
            <select name="select_fg_no[<?php echo $i; ?>]" id="select_fg_no_<?php echo $i; ?>" onchange="move(<?php echo $group[$i]['fg_no']?>, '<?php echo $group[$i]['fg_name']?>', this);">
                <option value=''></option>
                <option value='0'>미분류</option>
                <?php for ($j=0; $j<count($group); $j++) { ?>
                <?php if ($group[$i]['fg_no']==$group[$j]['fg_no']) continue; ?>
                <option value="<?php echo $group[$j]['fg_no']?>"> <?php echo $group[$j]['fg_name']?></option>
                <?php } ?>
            </select>
        </td>
        <td class="td_mng">
            <a href="/serv.php?m1=4&m2=5&fg_no=<?php echo $group[$i]['fg_no']?>">보기</a>
        </td>
    </tr>
    <?php } ?>
    </tbody>
    </table>
    
</div>

<div class="btn_list01 btn_list">
    <input type="submit" name="act_button" value="선택수정" onclick="document.pressed=this.value">
    <input type="submit" name="act_button" value="선택삭제" onclick="document.pressed=this.value">
    <input type="submit" name="act_button" value="선택비우기" onclick="document.pressed=this.value">
</div>

</form>
</div>